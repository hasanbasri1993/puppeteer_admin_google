<div class="space-y-6">
    <div class="border-b border-gray-200">
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Reset Password</h2>
        <p class="text-gray-600">Reset password untuk siswa atau pengguna</p>
    </div>

    <!-- Tab Navigation -->
    <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-8">
            <button onclick="switchTab('santri')" 
                    id="tab-santri"
                    class="tab-button py-2 px-1 border-b-2 font-medium text-sm border-primary text-primary">
                Santri
            </button>
            <button onclick="switchTab('umum')" 
                    id="tab-umum"
                    class="tab-button py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                Umum (Batch)
            </button>
        </nav>
    </div>

    <!-- Tab Content -->
    <div class="mt-6">
        <!-- Tab Santri -->
        <div id="content-santri" class="tab-content">
            <div class="space-y-4">
                <div>
                    <label for="nis-input" class="block text-sm font-medium text-gray-700 mb-2">
                        NIS Santri
                    </label>
                    <input type="text" 
                           id="nis-input" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                           placeholder="Masukkan NIS santri...">
                </div>

                <button onclick="processSantri()" 
                        class="w-full bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded-md transition duration-150 ease-in-out">
                    Reset Password
                </button>
            </div>
        </div>

        <!-- Tab Umum (Batch) -->
        <div id="content-umum" class="tab-content hidden">
            <div class="space-y-4">
                <div>
                    <label for="batch-ids-input" class="block text-sm font-medium text-gray-700 mb-2">
                        Masukkan ID atau Username (satu per baris)
                    </label>
                    <textarea id="batch-ids-input" 
                              rows="8" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                              placeholder="user1@example.com&#10;user2@example.com&#10;username1&#10;..."></textarea>
                </div>

                <button onclick="processUmum()" 
                        class="w-full bg-primary hover:bg-secondary text-white font-medium py-2 px-4 rounded-md transition duration-150 ease-in-out">
                    Reset Password
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Tab switching functionality
    function switchTab(tabName) {
        // Hide all tab contents
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });
        
        // Remove active class from all tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('border-primary', 'text-primary');
            button.classList.add('border-transparent', 'text-gray-500');
        });
        
        // Show selected tab content
        document.getElementById(`content-${tabName}`).classList.remove('hidden');
        
        // Add active class to selected tab button
        const activeButton = document.getElementById(`tab-${tabName}`);
        activeButton.classList.add('border-primary', 'text-primary');
        activeButton.classList.remove('border-transparent', 'text-gray-500');
    }
    
    // Process santri reset
    async function processSantri() {
        const nis = document.getElementById('nis-input').value.trim();
        
        if (!nis) {
            showAlert('Masukkan NIS santri', 'warning');
            return;
        }
        
        showLoading();
        
        try {
            const response = await fetch('/api/reset-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nis: nis })
            });
            
            const result = await response.json();
            
            if (result.status === 'sukses') {
                showAlert(result.message, 'success');
                document.getElementById('nis-input').value = '';
            } else {
                showAlert(result.message || 'Terjadi kesalahan', 'error');
            }
            
        } catch (error) {
            console.error('Error processing santri reset:', error);
            showAlert('Gagal memproses permintaan', 'error');
        } finally {
            hideLoading();
        }
    }
    
    // Process umum (batch) reset
    async function processUmum() {
        const batchIds = document.getElementById('batch-ids-input').value.trim();
        
        if (!batchIds) {
            showAlert('Masukkan minimal satu ID atau username', 'warning');
            return;
        }
        
        const idsArray = batchIds.split('\n').filter(id => id.trim());
        
        showLoading();
        
        try {
            const response = await fetch('/api/reset-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ batch_ids: idsArray })
            });
            
            const result = await response.json();
            
            if (result.status === 'sukses') {
                showAlert(result.message, 'success');
                document.getElementById('batch-ids-input').value = '';
            } else {
                showAlert(result.message || 'Terjadi kesalahan', 'error');
            }
            
        } catch (error) {
            console.error('Error processing umum reset:', error);
            showAlert('Gagal memproses permintaan', 'error');
        } finally {
            hideLoading();
        }
    }
</script>
